<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vote Visualisation</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container-horizontal">
    <svg viewBox="0 0 200 200" class="pie-chart">
      <defs>
        <linearGradient id="grad-red" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#c0392b"/>
          <stop offset="100%" stop-color="#e74c3c"/>
        </linearGradient>
        <linearGradient id="grad-blue" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#2471a3"/>
          <stop offset="100%" stop-color="#3498db"/>
        </linearGradient>
        <linearGradient id="grad-green" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#27ae60"/>
          <stop offset="100%" stop-color="#2ecc71"/>
        </linearGradient>
        <linearGradient id="grad-yellow" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#d4ac0d"/>
          <stop offset="100%" stop-color="#f1c40f"/>
        </linearGradient>
      </defs>

      <circle r="80" cx="100" cy="100" class="slice red" id="slice-red"></circle>
      <circle r="80" cx="100" cy="100" class="slice blue" id="slice-blue"></circle>
      <circle r="80" cx="100" cy="100" class="slice green" id="slice-green"></circle>
      <circle r="80" cx="100" cy="100" class="slice yellow" id="slice-yellow"></circle>
    </svg>

    <div class="bars-wrapper">
      <h1>Live Vote VIZZ</h1>

      <div class="bar-container">
        <div id="bar-red" class="bar red">
          <span class="label">ðŸ‡¨ðŸ‡¦ðŸ‡ºðŸ‡¸ CAN/U.S.</span>
          <span class="count" id="count-red">0%</span>
        </div>
      </div>
      <div class="bar-container">
        <div id="bar-blue" class="bar blue">
          <span class="label">ðŸ‡¬ðŸ‡§ UK</span>
          <span class="count" id="count-blue">0%</span>
        </div>
      </div>
      <div class="bar-container">
        <div id="bar-green" class="bar green">
          <span class="label">ðŸ‡¦ðŸ‡ºðŸ‡³ðŸ‡¿ AUS/NZ</span>
          <span class="count" id="count-green">0%</span>
        </div>
      </div>
      <div class="bar-container">
        <div id="bar-yellow" class="bar yellow">
          <span class="label">ðŸ‡ªðŸ‡º EURO</span>
          <span class="count" id="count-yellow">0%</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    const votesUrl = 'https://script.google.com/macros/s/AKfycbzv5LQFZ2Dj2x4OMQZr1o20acXoN4DCy8Vez7oxc1A8T0hCGBK5EqHusXWxq7yIgY21Pw/exec';

    async function fetchVotes() {
      try {
        const response = await fetch(votesUrl);
        const votes = await response.json();
        updateVisuals(votes);
      } catch (err) {
        console.error('Vote fetch failed:', err);
      }
    }

    function updateVisuals(votes) {
      const keys = ['votered', 'voteblue', 'votegreen', 'voteyellow'];
      const total = keys.reduce((sum, k) => sum + (votes[k] || 0), 0) || 1;
      let offset = 0;

      keys.forEach((key) => {
        const count = votes[key] || 0;
        const id = key.slice(4);
        const percent = Math.round((count / total) * 100);
        const bar = document.getElementById(`bar-${id}`);
        const countEl = document.getElementById(`count-${id}`);
        const slice = document.getElementById(`slice-${id}`);

        const width = percent + '%';
        if (bar.style.width !== width) {
          bar.classList.remove('blink');
          void bar.offsetWidth;
          bar.classList.add('blink');
        }

        bar.style.width = width;
        countEl.textContent = percent + '%';

        const dash = (percent / 100) * 502;
        slice.setAttribute('stroke-dasharray', `${dash} ${502 - dash}`);
        slice.setAttribute('stroke-dashoffset', -offset);
        offset += dash;
      });
    }

    fetchVotes();
    setInterval(fetchVotes, 10000);
  </script>
</body>
</html>
